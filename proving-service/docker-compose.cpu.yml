services:
  proving-service:
    build:
      context: ..
      dockerfile: ./proving-service/Dockerfile
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - RUST_LOG=info
      - PROOFS_DIR=/app/proofs
    volumes:
      - ./proofs:/app/proofs
    container_name: proving-service-cpu

  benchmark:
    build:
      context: .
      dockerfile: Dockerfile.benchmark
    environment:
      - PROVING_SERVICE_URL=http://proving-service:8080
      - PYTHONUNBUFFERED=1
    volumes:
      - ./benchmark/data:/benchmark/data
      - ./benchmark/benchmark.py:/app/benchmark.py:ro
    container_name: proving-benchmark-cpu
    depends_on:
      - proving-service
